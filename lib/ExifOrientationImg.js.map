{"version":3,"sources":["../src/ExifOrientationImg.js"],"names":["snakeToCamelCaseKeys","obj","Object","keys","map","k","replace","m","toUpperCase","reduce","a","b","ExifOrientationImg","state","orientation","args","event","otherArgs","imageElement","target","onLoad","props","windowImage","window","Image","getData","setState","getTag","src","alt","hide","style","imgProps","_onImageLoaded","bind","visibility"],"mappings":";;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,uBAAuB,SAAvBA,oBAAuB,CAACC,GAAD;AAAA,SAC3BC,OAAOC,IAAP,CAAYF,GAAZ,EACGG,GADH,CACO;AAAA,+BACFC,EAAEC,OAAF,CAAU,QAAV,EAAoB;AAAA,aAAKC,EAAE,CAAF,EAAKC,WAAL,EAAL;AAAA,KAApB,CADE,EAC6CP,IAAII,CAAJ,CAD7C;AAAA,GADP,EAIGI,MAJH,CAIU,UAACC,CAAD,EAAIC,CAAJ;AAAA,wBAAeD,CAAf,EAAqBC,CAArB;AAAA,GAJV,EAIoC,EAJpC,CAD2B;AAAA,CAA7B;;IAOMC,kB;;;;;;;;;;;;;;gNAEJC,K,GAEI;AACFC,mBAAa;AADX,K;;;;;qCAI2B;AAAA;;AAAA,yCAAbC,IAAa;AAAbA,YAAa;AAAA;;AAAA,2BACCA,IADD;AAAA,UACtBC,KADsB;AAAA,UACZC,SADY;;AAE7B,UAAMC,eAAiCF,MAAMG,MAA7C;AAF6B,UAGrBC,MAHqB,GAGV,KAAKC,KAHK,CAGrBD,MAHqB;;AAK7B;;AACA,UAAME,cAAcC,OAAOC,KAA3B;AACAD,aAAOC,KAAP,GAAe,IAAf;;AAEA;AACA,UAAI,CAAC,iBAAKC,OAAL,CAAaP,YAAb,EAA2B,YAAM;AACpC,eAAKQ,QAAL,CAAc;AACZZ,uBAAa,iBAAKa,MAAL,CAAYT,YAAZ,EAA0B,aAA1B;AADD,SAAd;AAGAE,kBAAUA,yBAAOJ,KAAP,4BAAiBC,SAAjB,GAAV;AACD,OALI,CAAL,EAKI;AACFG,kBAAUA,yBAAOJ,KAAP,4BAAiBC,SAAjB,GAAV;AACD;;AAED;AACAM,aAAOC,KAAP,GAAeF,WAAf;AACD;;;6BAEQ;AAAA,mBAQH,KAAKD,KARF;AAAA,UAELO,GAFK,UAELA,GAFK;AAAA,UAGLC,GAHK,UAGLA,GAHK;AAAA,UAILC,IAJK,UAILA,IAJK;AAAA,gCAKLC,KALK;AAAA,UAKLA,KALK,gCAKG,EALH;AAAA,UAMLX,MANK,UAMLA,MANK;AAAA,UAOFY,QAPE;;AAAA,UAULlB,WAVK,GAWH,KAAKD,KAXF,CAULC,WAVK;;;AAaP,aACE;AACE,gBAAQ,KAAKmB,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CADV;AAEE,aAAKN,GAFP;AAGE,aAAKC,GAHP;AAIE,4BAEIf,cACEd,qBAAqB,wBAASc,WAAT,CAArB,CADF,GAEE,EAACqB,YAAYL,OAAO,QAAP,GAAkB,SAA/B,EAJN,EAMKC,KANL;AAJF,SAYMC,QAZN,EADF;AAgBD;;;;;;kBAGYpB,kB","file":"ExifOrientationImg.js","sourcesContent":["/* @flow */\r\nimport React, { Component } from 'react';\r\nimport EXIF from 'exif-js';\r\nimport exif2css from './exif2css.js';\r\n\r\nconst snakeToCamelCaseKeys = (obj: Object): Object =>\r\n  Object.keys(obj)\r\n    .map(k => ({\r\n      [k.replace(/(-\\w)/g, m => m[1].toUpperCase())]: obj[k],\r\n    }))\r\n    .reduce((a, b) => ({...a, ...b}), {});\r\n\r\nclass ExifOrientationImg extends Component {\r\n  props: Object;\r\n  state: {\r\n    orientation: ?number,\r\n  } = {\r\n    orientation: null,\r\n  };\r\n\r\n  _onImageLoaded(...args: any[]) {\r\n    const [event, ...otherArgs] = args;\r\n    const imageElement: HTMLImageElement = event.target;\r\n    const { onLoad } = this.props;\r\n\r\n    // Fix for an issue affecting exif-js: see https://github.com/exif-js/exif-js/issues/95\r\n    const windowImage = window.Image\r\n    window.Image = null;\r\n    \r\n    // Do the actual EXIF operations\r\n    if (!EXIF.getData(imageElement, () => {\r\n      this.setState({\r\n        orientation: EXIF.getTag(imageElement, 'Orientation'),\r\n      });\r\n      onLoad && onLoad(event, ...otherArgs);\r\n    })) {\r\n      onLoad && onLoad(event, ...otherArgs);\r\n    }\r\n\r\n    // Re-establish the reference\r\n    window.Image = windowImage;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      src,\r\n      alt,\r\n      hide,\r\n      style = {},\r\n      onLoad,\r\n      ...imgProps,\r\n    } = this.props;\r\n    const {\r\n      orientation,\r\n    } = this.state;\r\n\r\n    return (\r\n      <img\r\n        onLoad={this._onImageLoaded.bind(this)}\r\n        src={src}\r\n        alt={alt}\r\n        style={{\r\n          ...(\r\n            orientation ?\r\n              snakeToCamelCaseKeys(exif2css(orientation)) :\r\n              {visibility: hide ? 'hidden' : 'visible'}\r\n          ),\r\n          ...style,\r\n        }}\r\n        {...imgProps}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport default ExifOrientationImg;\r\n"]}